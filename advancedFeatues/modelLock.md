# Блокировка модели

Optimacros предусматривает три уровня блокировки модели: `shared lock`, `unique lock` и `complete lock`. Скрипт может управлять первыми двумя из них функциями интерфейса [`ModelInfo`](../API/common.md#model-info). В рамках настоящего описания под пользователями модели подразумеваются все, кто к ней обращается: и люди, и скрипты, и приложения.

`Shared lock` – режим, не предполагающий изменение метаданных модели. В этом режиме можно читать данные модели и модифицировать данные мультикубов. Нет ограничения на количество пользователей.

`Unique lock` – режим, который включается непосредственно перед модификацией метаданных (например, добавлением элемента в справочник). Одновременно в этом режиме может существовать только один скрипт, при этом пользователи в режиме `shared lock` могут продолжать свою работу, поскольку модификация метаданных в Optimacros построена на транзакционном подходе. Непосредственно перед завершением (commit) транзакции уровень блокировки меняется на `complete lock`.

`Complete lock` – режим, при котором блокируются все пользователи.

Кроме того, существует режим `custom lock`, при котором скрипт находится вне контекста модели и не может с ней взаимодействовать. Он вызывается функцией `ModelInfo`.[`unlock()`](../API/common.md#model-info.unlock).

Каждый скрипт при старте находится в режиме `shared lock`.  Во вкладке `Макросы` -> `Скрипты` в столбце `Lock Mode` для каждого скрипта можно установить стартовый максимальный режим блокировки. При модификации метаданных скрипт переходит в режим `unique lock` и находится в нём либо до завершения (commit), либо до отката (rollback) транзакции. Перед завершением транзакции скрипт переходит в режим `complete lock`, а после завершения – в `shared lock`. В случае отката транзакции скрипт сразу возвращается в режим `shared lock`. В режимах `shared lock` и `custom lock` разные скрипты могут работать параллельно.

Такое устройство системы блокировок означает, что модели Optimacros позволяют эффективно многократно модифицировать данные мультикубов, не блокируя других пользователей. (Тем не менее, для ускорения множества таких операций рекомендуется группировать их, например, с помощью [`CellBuffer`](../API/common.md#cell-buffer), импорта из [`файла CSV`](../API/exportImport.md#import) или из [`базы данных`](../API/relationalDB.md#db-import)). Однако при многократной модификации метаданных, другие пользователи модели будут также многократно блокироваться. Поэтому особенно важно при проектировании скриптов предусмотреть группировку операций, в частности [добавления](../API/elementsManipulator.md#elements-creator), [удаления](../API/elementsManipulator.md#elements-deleter) или [тасования](../API/elementsManipulator.md#elements-reorder) элементов в справочниках.

[Расширенные возможности](advancedFeatues.md)

[Оглавление](../README.md)
